<div class="kt-portlet" [ngClass]="{ 'kt-portlet--body-progress kt-portlet--body-progress-overlay' : loading }">
	<div class="kt-portlet__head kt-portlet__head__custom">
		<div class="kt-portlet__head-label">
			<h3 class="kt-portlet__head-title">Contas a Receber</h3>
		</div>

		<div class="kt-portlet__head-toolbar">
			<button class="btn btn-sm btn-primary" (click)="open()" matTooltip="Cria uma nova conta a receber"
				*ngIf="permissions.contas_pagar_create">
				<i class="fas fa-plus"></i> Nova Conta
			</button>
			<button class="btn btn-sm btn-success" (click)="open_filters(filtros)" matTooltip="Filtra os dados">
				<i class="fas fa-sliders-h"></i> Filtros
			</button>
			<button class="btn btn-label-brand btn-bold btn-sm" (click)="load_list()" matTooltip="Atualiza a lista">
				<i class="fas fa-sync-alt" [class.fa-spin]="loading"></i>
			</button>
		</div>
	</div>
	<div class="kt-form kt-portlet__body">

		<div class="kt-portlet__body-progress">
			<mat-spinner [diameter]="40"></mat-spinner>
		</div>

		<div class="table-responsive">
			<table class="table  mb-0">
				<thead class="">
					<!-- <th width="10%">ID</th> -->
					<th width="5%"></th>
					<th width="20%">Cliente</th>
					<th width="20%">Descrição</th>
					<th width="13%">Vencimento</th>
					<th width="13%">Valor R$</th>
					<th width="10%">Situação</th>
					<th width="15%">
						<button class="btn btn-sm btn-warning" (click)="paymulti()"
							matTooltip="Receber contas selecionadas"
							*ngIf="permissions.contas_pagar_payment && contas.length > 0">
							<i class="fas fa-check"></i> Receber Contas
						</button>
					</th>
				</thead>
			</table>
			<div>
				<table class="table table-hover mb-0">
					<tbody>
						<tr *ngFor="let item of dataSource">
							<td width="5%">
								<input type="checkbox" [checked]="verificaItem(item)" (click)="checkItem(item)"
									*ngIf="item.situacao != 10">
								<i class="fas fa-check-circle text-success" *ngIf="item.situacao == 10"></i>
							</td>
							<!-- <td width="10%">{{item.sequencia}}</td> -->
							<td width="20%">{{item.cliente | titlecase}}</td>
							<td width="20%">
								<span>{{item.descricao }}</span>
							</td>
							<td width="13%">{{ item.vencimento | date: 'dd/MM/yyyy' }}</td>
							<th width="13%">{{ item.valor | currency:'R$' }}</th>
							<td width="10%">
								<span class="badge badge-secondary" *ngIf="item.situacao == 1">
									Em aberto
								</span>
								<span class="badge badge-danger" *ngIf="item.situacao == 0">
									Em Atraso
								</span>
								<span class="badge badge-success" *ngIf="item.situacao == 10">
									Paga
								</span>
							</td>
							<td width="15%">
								<div *ngIf="!contas.length">
									<button mat-icon-button color="primary" matTooltip="Detalhes" (click)="open(item)"
										*ngIf="permissions.contas_pagar_edit">
										<i class="fas fa-file" *ngIf="item.situacao == 10"></i>
										<i class="fas fa-pen" *ngIf="item.situacao != 10"></i>
									</button>
									<button mat-icon-button color="success" matTooltip="Receber Conta" (click)="pay(item)"
										*ngIf="permissions.contas_pagar_payment && item.situacao == 1">
										<i class="fas fa-money-bill"></i>
									</button>
									<button mat-icon-button color="warn" matTooltip="Deletar Nota"
										(click)="delete(item)"
										*ngIf="permissions.contas_pagar_delete && item.situacao != 10">
										<i class="fas fa-trash"></i>
									</button>
								</div>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>


	</div>
</div>

<ng-template #filtros let-modal>
	<div class="modal-header">
		<h4 class="modal-title" id="modal-basic-title">Filtros</h4>
		<button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
			<span aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body">
		<div class="row">
			<div class="col-sm-12 form-group">
				<span>Pesquisa:</span>
				<input type="text" class="form-control" [(ngModel)]="filters.termo">
			</div>

			<div class="col-sm-6 form-group">
				<span>Situação:</span>
				<select class="form-control" [(ngModel)]="filters.status">
					<option value="1">Abertas</option>
					<option value="10">Pagas</option>
					<option value="">Todas</option>
				</select>
			</div>
			<div class="col-sm-6 form-group">
				<span>Tipo:</span>
				<select class="form-control" [(ngModel)]="filters.tipo">
					<option value="0">Data</option>
					<option value="1">Mensal</option>
					<option value="2">Período</option>
				</select>
			</div>

			<div class="col-sm-6 form-group">
				<span *ngIf="filters.tipo != 2">Data:</span>
				<span *ngIf="filters.tipo == 2">Data Inicial:</span>
				<input type="date" class="form-control" [(ngModel)]="filters.data_ini" />
			</div>
			<div class="col-sm-6 form-group" *ngIf="filters.tipo == 2">
				<span>Data Final:</span>
				<input type="date" class="form-control" [(ngModel)]="filters.data_fim" />
			</div>
		</div>
	</div>
	<div class="modal-footer">
		<button type="button" class="btn btn-primary"
			(click)="modal.close('close click');load_list();">Confirmar</button>
	</div>
</ng-template>
